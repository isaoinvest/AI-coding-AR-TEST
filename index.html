<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="preconnect" href="https://aframe.io" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        margin: 0;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
        background-color: black;
        font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      /* æƒæ UI */
      #scanning-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        background-color: rgba(0, 0, 0, 0.1);
        transition: opacity 0.3s, visibility 0.3s;
        color: white;
        font-family: 'Inter', sans-serif;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        opacity: 1;
        visibility: visible;
      }

      #scanning-overlay.hidden {
        opacity: 0;
        visibility: hidden;
      }

      .scanner-frame {
        width: 180px;
        height: 180px;
        border: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 10px;
        position: relative;
        overflow: hidden;
      }

      .scanner-line {
        position: absolute;
        height: 2px;
        width: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.8), transparent);
        animation: scan 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        box-shadow: 0 0 5px rgba(0, 255, 255, 0.8);
      }

      @keyframes scan {
        0% { transform: translateY(0); }
        50% { transform: translateY(calc(180px - 2px)); }
        100% { transform: translateY(0); }
      }
      
      .scan-text {
        margin-top: 15px;
        font-size: 16px;
        color: rgba(255, 255, 255, 0.8);
      }
    </style>
  </head>
  <body>
    <div id="scanning-overlay">
      <div class="scanner-frame">
        <div class="scanner-line"></div>
      </div>
      <div class="scan-text">è«‹æƒæç›®æ¨™å½±åƒ</div>
    </div>

    <a-scene
      mindar-image="imageTargetSrc: https://raw.githubusercontent.com/isaoinvest/AI-coding-AR-TEST/main/targets.mind;
                    warmupTolerance: 5;
                    missTolerance: 10;
                    filterMinCF: 0.000001; 
                    filterBeta: 250;
                    uiScanning: #scanning-overlay;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      loading-screen="enabled: true; dotsColor: #fff; backgroundColor: #000"
    >
      <a-camera
        position="0 0 0"
        look-controls="enabled: false"
      ></a-camera>

      <!-- Target 0 with 3D info panel -->
      <a-entity
        id="target0"
        mindar-image-target="targetIndex: 0"
      >
        <!-- 3D è³‡è¨Šé¢æ¿ -->
        <a-plane
          id="info-panel-0"
          position="0 0 0.05"
          width="1.5"
          height="1.0"
          rotation="0 0 0"
          material="color: #000; opacity: 0.2; transparent: true; shader: flat; side: double"
          visible="false"
        >
          <!-- èƒŒæ™¯ç»ç’ƒæ•ˆæœ -->
          <a-plane
            position="0 0 -0.001"
            width="1.5"
            height="1.0"
            material="color: #ffffff; opacity: 0.03; transparent: true; shader: flat; side: double"
          ></a-plane>
          
          <!-- é‚Šæ¡† -->
          <a-plane
            position="0 0 0.001"
            width="1.51"
            height="1.01"
            material="color: #00ffff; opacity: 0.35; transparent: true; shader: flat; side: double"
          ></a-plane>
          
          <!-- ç™¼å…‰é‚Šæ¡†æ•ˆæœ -->
          <a-plane
            position="0 0 0.002"
            width="1.53"
            height="1.03"
            material="color: #00ffff; opacity: 0.2; transparent: true; shader: flat; side: double"
            animation="property: material.opacity; from: 0.15; to: 0.4; dur: 2000; dir: alternate; loop: true; easing: easeInOutSine"
          ></a-plane>

          <!-- æ¨™é¡Œå€åŸŸ -->
          <a-plane
            position="0 0.38 0.003"
            width="1.4"
            height="0.15"
            material="color: #00ffff; opacity: 0.15; transparent: true; shader: flat; side: double"
          >
            <a-text
              value="ğŸ“± äº’å‹•å½±ç‰‡é«”é©—"
              position="0 0 0.001"
              width="1.2"
              align="center"
              color="#ffffff"
              shader="msdf"
              font="https://cdn.aframe.io/examples/ui/Viga-Regular.json"
            ></a-text>
          </a-plane>

          <!-- å…§å®¹æ–‡å­— -->
          <a-text
            id="text-content-0"
            value="å‰µæ–°çš„ AR äº’å‹•å½±ç‰‡å±•ç¤º\nçµåˆåœ–åƒè­˜åˆ¥æŠ€è¡“\næ²‰æµ¸å¼é«”é©—è¨­è¨ˆ"
            position="0 0.05 0.003"
            width="1.1"
            align="center"
            color="#ffffff"
            opacity="0.9"
            line-height="60"
            shader="msdf"
            font="https://cdn.aframe.io/examples/ui/Viga-Regular.json"
          ></a-text>

          <!-- åº•éƒ¨ç‹€æ…‹æ¬„ -->
          <a-plane
            position="0 -0.42 0.003"
            width="1.4"
            height="0.1"
            material="color: #ffffff; opacity: 0.1; transparent: true; shader: flat; side: double"
          >
            <!-- ç‹€æ…‹é» -->
            <a-sphere
              position="-0.5 0 0.002"
              radius="0.02"
              material="color: #00ffff; opacity: 0.8; shader: flat; side: double"
              animation="property: scale; from: 1 1 1; to: 1.4 1.4 1.4; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine"
            ></a-sphere>
            
            <a-text
              value="Target ID: 0  |  å·²è¿½è¹¤"
              position="0.1 0 0.002"
              width="0.8"
              align="center"
              color="#ffffff"
              opacity="0.7"
              shader="msdf"
              font="https://cdn.aframe.io/examples/ui/Viga-Regular.json"
            ></a-text>
          </a-plane>

          <!-- å››è§’è£é£¾ -->
          <a-entity position="-0.73 0.48 0.004">
            <a-plane width="0.1" height="0.008" position="0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 -0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
          <a-entity position="0.73 0.48 0.004">
            <a-plane width="0.1" height="0.008" position="-0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 -0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
          <a-entity position="-0.73 -0.48 0.004">
            <a-plane width="0.1" height="0.008" position="0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
          <a-entity position="0.73 -0.48 0.004">
            <a-plane width="0.1" height="0.008" position="-0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
        </a-plane>
      </a-entity>
      
      <!-- Target 1 with 3D info panel -->
      <a-entity
        id="target1"
        mindar-image-target="targetIndex: 1"
      >
        <!-- 3D è³‡è¨Šé¢æ¿ -->
        <a-plane
          id="info-panel-1"
          position="0 0 0.05"
          width="1.5"
          height="1.0"
          rotation="0 0 0"
          material="color: #000; opacity: 0.2; transparent: true; shader: flat; side: double"
          visible="false"
        >
          <!-- èƒŒæ™¯ç»ç’ƒæ•ˆæœ -->
          <a-plane
            position="0 0 -0.001"
            width="1.5"
            height="1.0"
            material="color: #ffffff; opacity: 0.03; transparent: true; shader: flat; side: double"
          ></a-plane>
          
          <!-- é‚Šæ¡† -->
          <a-plane
            position="0 0 0.001"
            width="1.51"
            height="1.01"
            material="color: #00ffff; opacity: 0.35; transparent: true; shader: flat; side: double"
          ></a-plane>
          
          <!-- ç™¼å…‰é‚Šæ¡†æ•ˆæœ -->
          <a-plane
            position="0 0 0.002"
            width="1.53"
            height="1.03"
            material="color: #00ffff; opacity: 0.2; transparent: true; shader: flat; side: double"
            animation="property: material.opacity; from: 0.15; to: 0.4; dur: 2000; dir: alternate; loop: true; easing: easeInOutSine"
          ></a-plane>

          <!-- æ¨™é¡Œå€åŸŸ -->
          <a-plane
            position="0 0.38 0.003"
            width="1.4"
            height="0.15"
            material="color: #00ffff; opacity: 0.15; transparent: true; shader: flat; side: double"
          >
            <a-text
              value="ğŸ¬ é€²éšå…§å®¹å±•ç¤º"
              position="0 0 0.001"
              width="1.2"
              align="center"
              color="#ffffff"
              shader="msdf"
              font="https://cdn.aframe.io/examples/ui/Viga-Regular.json"
            ></a-text>
          </a-plane>

          <!-- å…§å®¹æ–‡å­— -->
          <a-text
            id="text-content-1"
            value="é«”é©—æœªä¾†ç§‘æŠ€è¦–è¦ºå‘ˆç¾\né€é AR æŠ€è¡“\næ•¸ä½å…§å®¹èˆ‡çœŸå¯¦ä¸–ç•Œçµåˆ"
            position="0 0.05 0.003"
            width="1.1"
            align="center"
            color="#ffffff"
            opacity="0.9"
            line-height="60"
            shader="msdf"
            font="https://cdn.aframe.io/examples/ui/Viga-Regular.json"
          ></a-text>

          <!-- åº•éƒ¨ç‹€æ…‹æ¬„ -->
          <a-plane
            position="0 -0.42 0.003"
            width="1.4"
            height="0.1"
            material="color: #ffffff; opacity: 0.1; transparent: true; shader: flat; side: double"
          >
            <!-- ç‹€æ…‹é» -->
            <a-sphere
              position="-0.5 0 0.002"
              radius="0.02"
              material="color: #00ffff; opacity: 0.8; shader: flat; side: double"
              animation="property: scale; from: 1 1 1; to: 1.4 1.4 1.4; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine"
            ></a-sphere>
            
            <a-text
              value="Target ID: 1  |  å·²è¿½è¹¤"
              position="0.1 0 0.002"
              width="0.8"
              align="center"
              color="#ffffff"
              opacity="0.7"
              shader="msdf"
              font="https://cdn.aframe.io/examples/ui/Viga-Regular.json"
            ></a-text>
          </a-plane>

          <!-- å››è§’è£é£¾ -->
          <a-entity position="-0.73 0.48 0.004">
            <a-plane width="0.1" height="0.008" position="0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 -0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
          <a-entity position="0.73 0.48 0.004">
            <a-plane width="0.1" height="0.008" position="-0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 -0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
          <a-entity position="-0.73 -0.48 0.004">
            <a-plane width="0.1" height="0.008" position="0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
          <a-entity position="0.73 -0.48 0.004">
            <a-plane width="0.1" height="0.008" position="-0.05 0 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
            <a-plane width="0.008" height="0.1" position="0 0.05 0" material="color: #00ffff; opacity: 0.6; shader: flat; side: double"></a-plane>
          </a-entity>
        </a-plane>
      </a-entity>
    </a-scene>

    <script>
      window.addEventListener('DOMContentLoaded', () => {
        if (window.AFRAME) initApp();
        else window.addEventListener('load', initApp);
      });

      function initApp() {
        const SCENE = document.querySelector("a-scene");
        const targetEl0 = document.querySelector("#target0");
        const targetEl1 = document.querySelector("#target1");
        const scanningOverlay = document.getElementById("scanning-overlay");
        const infoPanel0 = document.querySelector("#info-panel-0");
        const infoPanel1 = document.querySelector("#info-panel-1");

        let activeTargets = new Set();

        // é¡¯ç¤º 3D è³‡è¨Šé¢æ¿
        function showInfoPanel(targetIndex) {
          const panel = targetIndex === 0 ? infoPanel0 : infoPanel1;
          
          // è¨­ç‚ºå¯è¦‹ä¸¦æ·»åŠ æ¼¸å…¥å‹•ç•«
          panel.setAttribute('visible', true);
          panel.setAttribute('animation', {
            property: 'scale',
            from: '0.5 0.5 0.5',
            to: '1 1 1',
            dur: 500,
            easing: 'easeOutElastic'
          });
          panel.setAttribute('animation__opacity', {
            property: 'material.opacity',
            from: 0,
            to: 0.15,
            dur: 500
          });
        }

        // éš±è— 3D è³‡è¨Šé¢æ¿
        function hideInfoPanel(targetIndex) {
          const panel = targetIndex === 0 ? infoPanel0 : infoPanel1;
          
          // æ·¡å‡ºå‹•ç•«
          panel.setAttribute('animation', {
            property: 'scale',
            to: '0.5 0.5 0.5',
            dur: 300,
            easing: 'easeInQuad'
          });
          panel.setAttribute('animation__opacity', {
            property: 'material.opacity',
            to: 0,
            dur: 300
          });
          
          // å‹•ç•«çµæŸå¾Œéš±è—
          setTimeout(() => {
            panel.setAttribute('visible', false);
          }, 300);
        }

        // å•Ÿå‹•ç›®æ¨™
        function activateTarget(targetIndex) {
          activeTargets.add(targetIndex);
          
          // é¡¯ç¤ºå°æ‡‰çš„ 3D é¢æ¿
          showInfoPanel(targetIndex);
        }

        // åœç”¨ç›®æ¨™
        function deactivateTarget(targetIndex) {
          activeTargets.delete(targetIndex);
          
          // éš±è—å°æ‡‰çš„ 3D é¢æ¿
          hideInfoPanel(targetIndex);
          
          // å¦‚æœæ²’æœ‰ä»»ä½•æ´»å‹•ç›®æ¨™ï¼Œé¡¯ç¤ºæƒæ UI
          if (activeTargets.size === 0) {
            setTimeout(() => {
              if (activeTargets.size === 0) {
                scanningOverlay.classList.remove("hidden");
              }
            }, 500);
          }
        }

        // Target 0 äº‹ä»¶
        targetEl0.addEventListener("targetFound", () => {
          activateTarget(0);
        });

        targetEl0.addEventListener("targetLost", () => {
          deactivateTarget(0);
        });

        // Target 1 äº‹ä»¶
        targetEl1.addEventListener("targetFound", () => {
          activateTarget(1);
        });

        targetEl1.addEventListener("targetLost", () => {
          deactivateTarget(1);
        });

        // é é¢å¯è¦‹æ€§è™•ç†
        document.addEventListener("visibilitychange", () => {
          if (document.hidden) {
            // ç•¶é é¢éš±è—æ™‚ï¼Œæ¸…ç©ºæ´»å‹•ç›®æ¨™é›†åˆ
            activeTargets.clear();
          }
        });
      }
    </script>
  </body>
</html>
